import{i as j,u as g,k as f,t as c,s as x,o as p,j as t,r as b,m as M,n as v,M as y,V as A,C as w}from"./index-C9PgoutN.js";import{C as E,a as k,b as h,d as m,e as T,f as N,g as R,h as _,i as $}from"./context-menu-t-PSiTGx.js";import{Q as C}from"./query-enum-C5aGOuRN.js";import{S as d}from"./smart-marquee-LBXNHBv0.js";function q(o){const{album:e,enabled:i}=o,{name:a,id:r}=e,u=j(),{data:s,refetch:n}=g({queryKey:[C.album.IS_SAVED,r],queryFn:async()=>x.currentUser.albums.hasSavedAlbums([r]),select:l=>l[0],initialData:[!0],enabled:i}),{mutate:S}=f({mutationFn:()=>x.makeRequest(s?"DELETE":"PUT","me/albums",{ids:[e.id]}),onSuccess:()=>{setTimeout(n,1e3),u.invalidateQueries({queryKey:[C.album.SAVED_LIST]}),c.success(`${s?"Removed":"Added"} ${a} ${s?"from":"to"} library`)},onError:l=>{console.error(l),c.error(`Failed to ${s?"remove":"add"} ${a} ${s?"from":"to"} library`)}});return{isSaved:s,mutateSaved:S}}function D(o){const{album:e,open:i}=o,a=p(),{isSaved:r,mutateSaved:u}=q({album:e,enabled:i});return t.jsxs(E,{children:[t.jsxs(k,{className:"grid w-60 grid-cols-[auto_1fr] grid-rows-[repeat(auto,4)] items-center gap-x-3 [&_*]:text-xs",children:[t.jsx("img",{className:"col-span-1 row-span-4 size-20 rounded-sm border-[0.0625rem] border-fg",src:e.images.length>0?e.images[0].url:""}),t.jsx(d,{className:"row-span-1",children:e.name}),t.jsx(d,{className:"row-span-1",children:e.artists.map(s=>s.name).join(",")}),t.jsx(d,{className:"row-span-1",children:new Date(e.release_date).getFullYear()})]}),t.jsx(h,{}),t.jsxs(m,{onClick:()=>u(),children:[r?"Remove from":"Add to"," Library"]}),t.jsx(h,{}),e.artists.length===1?t.jsx(m,{onClick:a(e.artists[0].name,"Artist",{id:e.artists[0].id}),children:"Go to artist"}):t.jsxs(T,{children:[t.jsx(N,{children:"Go to artist"}),t.jsx(R,{className:"w-44",children:e.artists.sort((s,n)=>s.name.localeCompare(n.name)).map(s=>t.jsx(m,{onClick:a(s.name,"Artist",{id:s.id}),children:s.name},s.id))})]})]})}const V=b.memo(o=>{const{album:e,style:i}=o,[a,r]=b.useState(!1),u=p(),s=M(v(({item:n})=>n&&"album"in n?n.album:void 0));return t.jsxs(_,{onOpenChange:r,children:[t.jsx($,{asChild:!0,children:t.jsx(y,{style:i,onClick:u(e.name,"Album",{id:e.id}),icon:s&&s.id===e.id?[A,w]:void 0,children:e.name})}),t.jsx(D,{album:e,open:a})]})});export{V as A};
