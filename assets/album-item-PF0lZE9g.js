import{i as j,d as g,t as c,s as x,f as p,j as t,r as b,u as S,b as f,M as v,C as M}from"./index-CC42YDAp.js";import{C as y,a as A,b as h,d as l,e as w,f as k,g as T,h as E,i as N}from"./context-menu-Dz9cmCnd.js";import{u as $}from"./useQuery-BOmUSlsH.js";import{S as d}from"./smart-marquee-_rIHBaKJ.js";import{V as q}from"./volume-D07C1BSE.js";function R(r){const{album:e,enabled:o}=r,{name:a,id:n}=e,i=j(),{data:s,refetch:m}=$({queryKey:["has-saved-album",n],queryFn:async()=>x.currentUser.albums.hasSavedAlbums([n]),select:u=>u[0],initialData:[!0],enabled:o}),{mutate:C}=g({mutationFn:()=>x.makeRequest(s?"DELETE":"PUT","me/albums",{ids:[e.id]}),onSuccess:()=>{setTimeout(m,1e3),i.invalidateQueries({queryKey:["saved_albums"]}),c.success(`${s?"Removed":"Added"} ${a} ${s?"from":"to"} library`)},onError:u=>{console.error(u),c.error(`Failed to ${s?"remove":"add"} ${a} ${s?"from":"to"} library`)}});return{isSaved:s,mutateSaved:C}}function F(r){const{album:e,open:o}=r,a=p(),{isSaved:n,mutateSaved:i}=R({album:e,enabled:o});return t.jsxs(y,{children:[t.jsxs(A,{className:"grid w-60 grid-cols-[auto_1fr] grid-rows-[repeat(auto,4)] items-center gap-x-3 [&_*]:text-xs",children:[t.jsx("img",{className:"col-span-1 row-span-4 size-20 rounded-sm border-[0.0625rem] border-fg",src:e.images.length>0?e.images[0].url:""}),t.jsx(d,{className:"row-span-1",children:e.name}),t.jsx(d,{className:"row-span-1",children:e.artists.map(s=>s.name).join(",")}),t.jsx(d,{className:"row-span-1",children:new Date(e.release_date).getFullYear()})]}),t.jsx(h,{}),t.jsxs(l,{onClick:()=>i(),children:[n?"Remove from":"Add to"," Library"]}),t.jsx(h,{}),e.artists.length===1?t.jsx(l,{onClick:a(e.artists[0].name,"Artist",{id:e.artists[0].id}),children:"Go to artist"}):t.jsxs(w,{children:[t.jsx(k,{children:"Go to artist"}),t.jsx(T,{className:"w-44",children:e.artists.sort((s,m)=>s.name.localeCompare(m.name)).map(s=>t.jsx(l,{onClick:a(s.name,"Artist",{id:s.id}),children:s.name},s.id))})]})]})}const G=b.memo(r=>{const{album:e,style:o}=r,[a,n]=b.useState(!1),i=p(),s=S(f(m=>m.item));return t.jsxs(E,{onOpenChange:n,children:[t.jsx(N,{asChild:!0,children:t.jsx(v,{style:o,onClick:i(e.name,"Album",{id:e.id}),icon:s&&"album"in s&&s.album.id===e.id?[q,M]:void 0,children:e.name})}),t.jsx(F,{album:e,open:a})]})});export{G as A};
