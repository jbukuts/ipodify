import{d as j,e as S,s as h,Q as y,t as m,j as e,f as M,r as g,u as _,b as Q,M as q,V as N}from"./index-DXhZx8HB.js";import{C as L,a as v,b as C,d as u,e as E,f as I,g as w,h as P,i as K}from"./context-menu-BwlKXlD5.js";import{S as b}from"./smart-marquee-D7xVAogL.js";import{u as R}from"./use-saved-playlists-BRJEmNG9.js";import{u as G}from"./useQuery-BoCq9VOO.js";function U(){const n=j(),{mutate:s}=S({mutationFn:a=>h.player.addItemToPlaybackQueue(a.uri),onSuccess:(a,t)=>{m.success(e.jsxs("p",{children:["Added ",e.jsx("b",{children:t.name})," to queue"]}))},onError:a=>{console.error(a),m.error("Failed to add to queue")},onSettled:()=>{n.invalidateQueries({queryKey:[y.player.QUEUE]})}});return s}function $(){const n=j(),{mutate:s}=S({mutationFn:a=>h.playlists.addItemsToPlaylist(a.playlist.id,[a.item.uri]),onSuccess:(a,t)=>{setTimeout(()=>{n.invalidateQueries({refetchType:"all",queryKey:[y.playlist.GET,t.playlist.id]}),n.invalidateQueries({refetchType:"all",queryKey:[y.playlist.TRACKS,t.playlist.id]})},1e3),m.success("Added to playlist",{description:e.jsxs(e.Fragment,{children:["Added ",e.jsx("b",{children:t.item.name})," to ",e.jsx("b",{children:t.playlist.name})]})})},onError:(a,t)=>{console.error(a),m.error("Failed to add to playlist",{description:e.jsxs(e.Fragment,{children:["Could not add ",e.jsx("b",{children:t.item.name})," to ",e.jsx("b",{children:t.playlist.name})]})})}});return s}function D(){const n=j(),{mutate:s}=S({mutationFn:a=>{const{playlistId:t,trackUris:i}=a;return h.playlists.removeItemsFromPlaylist(t,{tracks:i.map(l=>({uri:l}))})},onSuccess:(a,t)=>{m.success("Removed item from playlist"),setTimeout(()=>{n.invalidateQueries({queryKey:[y.playlist.GET,t.playlistId]}),n.invalidateQueries({queryKey:[y.playlist.TRACKS,t.playlistId]})},1e3)},onError:a=>{console.error(a),m.success("Failed to remove item from playlist")}});return s}function O(n){const{track:s,enabled:a,initial:t=!1}=n,{id:i,name:l}=s,o=j(),{data:r,refetch:p}=G({queryKey:[y.track.IS_SAVED,i],initialData:[t??!0],queryFn:()=>h.currentUser.tracks.hasSavedTracks([i]),select:d=>d[0],enabled:a&&!t}),{mutate:x}=S({mutationFn:()=>h.makeRequest(r?"DELETE":"PUT","me/tracks",{ids:[s.id]}),onSuccess:()=>{o.invalidateQueries({queryKey:[y.track.SAVED_LIST]}),setTimeout(p,500),m.success(`${r?"Removed":"Added"} ${l} ${r?"from":"to"} Liked Songs`)},onError:d=>{console.error(d),m.error(`Failed to ${r?"remove":"add"} ${l} ${r?"from":"to"} Liked Songs`)}});return{isSaved:r,toggleLiked:x}}function V(n){const{track:s}=n,[a,t]=g.useState(!1),{playlists:i,isLoading:l}=R({enabled:a,ownerOnly:!0}),o=$();return e.jsxs(E,{onOpenChange:t,children:[e.jsx(I,{children:"Add to playlist"}),e.jsxs(w,{className:"max-h-80 overflow-y-auto",children:[e.jsx(u,{disabled:!0,children:"New Playlist"}),e.jsx(C,{}),l?e.jsx(v,{className:"animate-pulse text-center",children:"..."}):i.map((r,p)=>e.jsx(u,{onSelect:x=>x.preventDefault(),className:"truncate",onClick:()=>o({item:s,playlist:r}),children:r.name},p))]})]})}function Y(n){const{track:s,open:a,isLiked:t,playlistId:i,showGoToAlbum:l=!0}=n,o=M(),r=U(),p=D(),{toggleLiked:x,isSaved:d}=O({track:s,enabled:a,initial:t});return e.jsxs(L,{children:["album"in s&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:"grid w-60 grid-cols-[auto_1fr] grid-rows-[repeat(auto,4)] items-center gap-x-3 [&_*]:text-xs",children:[e.jsx("img",{className:"col-span-1 row-span-4 size-20 rounded-sm border-[0.0625rem] border-fg",src:s.album.images.length>0?s.album.images[0].url:""}),e.jsx(b,{className:"row-span-1",children:s.name}),e.jsx(b,{className:"row-span-1",children:s.artists.map(c=>c.name).join(",")}),e.jsx(b,{className:"row-span-1",children:s.album.name}),e.jsx(b,{className:"row-span-1",children:new Date(s.album.release_date).getFullYear()})]}),e.jsx(C,{})]}),e.jsx(V,{track:s}),i&&e.jsx(u,{onClick:()=>p({playlistId:i,trackUris:[s.uri]}),children:"Remove from this playlist"}),e.jsxs(u,{onClick:()=>x(),children:[d?"Remove from":"Add to"," Liked Songs"]}),e.jsx(u,{onClick:()=>r(s),children:"Add to queue"}),e.jsx(C,{}),"artists"in s&&(s.artists.length===1?e.jsx(u,{onClick:o(s.artists[0].name,"Artist",{id:s.artists[0].id}),children:"Go to artist"}):e.jsxs(E,{children:[e.jsx(I,{children:"Go to artist"}),e.jsx(w,{className:"w-44",children:s.artists.sort((c,k)=>c.name.localeCompare(k.name)).map(c=>e.jsx(u,{onClick:o(c.name,"Artist",{id:c.id}),children:c.name}))})]})),l&&"album"in s&&e.jsx(u,{onClick:o(s.album.name,"Album",{id:s.album.id}),children:"Go to album"})]})}function z(n){var T;const{track:s,trackNumber:a,onClick:t,isLiked:i,playlistId:l,showGoToAlbum:o=!0,...r}=n,[p,x]=g.useState(!1),d=a??("track_number"in s?s.track_number:null),c=d?`${d}. `:null,k=_(Q(f=>{var A;return(A=f.item)==null?void 0:A.id})),F=t&&(f=>{t&&t(f)});return e.jsxs(P,{onOpenChange:x,children:[e.jsx(K,{asChild:!0,children:e.jsxs(q,{disabled:s.is_playable&&!s.is_playable||!!s.restrictions,onClick:F,...r,icon:k===s.id||"linked_from"in s&&((T=s.linked_from)==null?void 0:T.id)===k?N:!1,children:[c,s.name]})}),e.jsx(Y,{track:s,open:p,isLiked:i,playlistId:l,showGoToAlbum:o})]})}const Z=g.memo(z);export{Z as T};
