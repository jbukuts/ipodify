import{r as a,w as b,i as w,x as Q,y as p,z as S}from"./index-Wnh6dWoM.js";var x=a.createContext(!1),T=()=>a.useContext(x);x.Provider;function _(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var q=a.createContext(_()),B=()=>a.useContext(q),H=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},I=e=>{a.useEffect(()=>{e.clearReset()},[e])},M=({result:e,errorResetBoundary:t,throwOnError:i,query:s,suspense:u})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(u&&e.data===void 0||b(i,[e.error,s])),O=e=>{if(e.suspense){const t=s=>s==="static"?s:Math.max(s??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...s)=>t(i(...s)):t(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},P=(e,t)=>e.isLoading&&e.isFetching&&!t,d=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,C=(e,t,i)=>t.fetchOptimistic(e).catch(()=>{i.clearReset()});function k(e,t,i){var h,g,y,R,m;const s=T(),u=B(),o=w(),r=o.defaultQueryOptions(e);(g=(h=o.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||g.call(h,r),r._optimisticResults=s?"isRestoring":"optimistic",O(r),H(r,u),I(u);const E=!o.getQueryCache().get(r.queryHash),[n]=a.useState(()=>new t(o,r)),c=n.getOptimisticResult(r),f=!s&&e.subscribed!==!1;if(a.useSyncExternalStore(a.useCallback(l=>{const v=f?n.subscribe(Q.batchCalls(l)):p;return n.updateResult(),v},[n,f]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),a.useEffect(()=>{n.setOptions(r)},[r,n]),d(r,c))throw C(r,n,u);if(M({result:c,errorResetBoundary:u,throwOnError:r.throwOnError,query:o.getQueryCache().get(r.queryHash),suspense:r.suspense}))throw c.error;if((R=(y=o.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||R.call(y,r,c),r.experimental_prefetchInRender&&!S&&P(c,s)){const l=E?C(r,n,u):(m=o.getQueryCache().get(r.queryHash))==null?void 0:m.promise;l==null||l.catch(p).finally(()=>{n.updateResult()})}return r.notifyOnChangeProps?c:n.trackResult(c)}export{k as u};
