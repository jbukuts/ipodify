import{d as k,e as j,s as h,Q as y,t as d,j as t,f as M,r as g,u as v,b as A,M as N,V as q}from"./index-DfWu0XcN.js";import{C as P,a as I,b as C,d as p,e as w,f as _,g as F,h as K,i as L}from"./context-menu-C80MbDdp.js";import{S as f}from"./smart-marquee-BcDRQkC3.js";import{u as R}from"./use-saved-playlists-C1eySg40.js";import{u as U}from"./useQuery-Cj0VkjqC.js";function D(){const r=k(),{mutate:e}=j({mutationFn:s=>h.player.addItemToPlaybackQueue(s.uri),onSuccess:(s,a)=>{d.success(t.jsxs("p",{children:["Added ",t.jsx("b",{children:a.name})," to queue"]}))},onError:s=>{console.error(s),d.error("Failed to add to queue")},onSettled:()=>{r.invalidateQueries({queryKey:[y.player.QUEUE]})}});return e}function G(){const r=k(),{mutate:e}=j({mutationFn:s=>h.playlists.addItemsToPlaylist(s.playlist.id,[s.item.uri]),onSuccess:(s,a)=>{setTimeout(()=>{r.invalidateQueries({refetchType:"all",queryKey:[y.playlist.GET,a.playlist.id]}),r.invalidateQueries({refetchType:"all",queryKey:[y.playlist.TRACKS,a.playlist.id]})},1e3),d.success("Added to playlist",{description:t.jsxs(t.Fragment,{children:["Added ",t.jsx("b",{children:a.item.name})," to ",t.jsx("b",{children:a.playlist.name})]})})},onError:(s,a)=>{console.error(s),d.error("Failed to add to playlist",{description:t.jsxs(t.Fragment,{children:["Could not add ",t.jsx("b",{children:a.item.name})," to ",t.jsx("b",{children:a.playlist.name})]})})}});return e}function O(){const r=k(),{mutate:e}=j({mutationFn:s=>{const{playlistId:a,trackUris:i}=s;return h.playlists.removeItemsFromPlaylist(a,{tracks:i.map(o=>({uri:o}))})},onSuccess:(s,a)=>{d.success("Removed item from playlist"),setTimeout(()=>{r.invalidateQueries({queryKey:[y.playlist.GET,a.playlistId]}),r.invalidateQueries({queryKey:[y.playlist.TRACKS,a.playlistId]})},1e3)},onError:s=>{console.error(s),d.success("Failed to remove item from playlist")}});return e}function $(r){const{track:e,enabled:s,initial:a=!1}=r,{id:i,name:o}=e,l=k(),{data:n,refetch:c}=U({queryKey:[y.track.IS_SAVED,i],initialData:[a??!0],queryFn:()=>h.currentUser.tracks.hasSavedTracks([i]),select:m=>m[0],enabled:s&&!a}),{mutate:x}=j({mutationFn:()=>h.makeRequest(n?"DELETE":"PUT","me/tracks",{ids:[e.id]}),onSuccess:()=>{l.invalidateQueries({queryKey:[y.track.SAVED_LIST]}),setTimeout(c,500),d.success(`${n?"Removed":"Added"} ${o} ${n?"from":"to"} Liked Songs`)},onError:m=>{console.error(m),d.error(`Failed to ${n?"remove":"add"} ${o} ${n?"from":"to"} Liked Songs`)}});return{isSaved:n,toggleLiked:x}}function V(r){const{track:e}=r,[s,a]=g.useState(!1),{playlists:i,isLoading:o}=R({enabled:s,ownerOnly:!0}),l=G();return t.jsxs(w,{onOpenChange:a,children:[t.jsx(_,{children:"Add to playlist"}),t.jsxs(F,{className:"max-h-80 overflow-y-auto",children:[t.jsx(p,{disabled:!0,children:"New Playlist"}),t.jsx(C,{}),o?t.jsx(I,{className:"animate-pulse text-center",children:"..."}):i.map((n,c)=>t.jsx(p,{onSelect:x=>x.preventDefault(),className:"truncate",onClick:()=>l({item:e,playlist:n}),children:n.name},c))]})]})}function Y(r){const{track:e,open:s,isLiked:a,playlistId:i,showGoToAlbum:o=!0}=r,l=M(),n=D(),c=O(),{toggleLiked:x,isSaved:m}=$({track:e,enabled:s,initial:a});return t.jsxs(P,{children:["album"in e&&t.jsxs(t.Fragment,{children:[t.jsxs(I,{className:"grid w-60 grid-cols-[auto_1fr] grid-rows-[repeat(auto,4)] items-center gap-x-3 [&_*]:text-xs",children:[t.jsx("img",{className:"col-span-1 row-span-4 size-20 rounded-sm border-[0.0625rem] border-fg",src:e.album.images.length>0?e.album.images[0].url:""}),t.jsx(f,{className:"row-span-1",children:e.name}),t.jsx(f,{className:"row-span-1",children:e.artists.map(u=>u.name).join(",")}),t.jsx(f,{className:"row-span-1",children:e.album.name}),t.jsx(f,{className:"row-span-1",children:new Date(e.album.release_date).getFullYear()})]}),t.jsx(C,{})]}),t.jsx(V,{track:e}),i&&t.jsx(p,{onClick:()=>c({playlistId:i,trackUris:[e.uri]}),children:"Remove from this playlist"}),t.jsxs(p,{onClick:()=>x(),children:[m?"Remove from":"Add to"," Liked Songs"]}),t.jsx(p,{onClick:()=>n(e),children:"Add to queue"}),t.jsx(C,{}),"artists"in e&&(e.artists.length===1?t.jsx(p,{onClick:l(e.artists[0].name,"Artist",{id:e.artists[0].id}),children:"Go to artist"}):t.jsxs(w,{children:[t.jsx(_,{children:"Go to artist"}),t.jsx(F,{className:"w-44",children:e.artists.sort((u,b)=>u.name.localeCompare(b.name)).map(u=>t.jsx(p,{onClick:l(u.name,"Artist",{id:u.id}),children:u.name}))})]})),o&&"album"in e&&t.jsx(p,{onClick:l(e.album.name,"Album",{id:e.album.id}),children:"Go to album"})]})}function z(r){var T;const{track:e,trackNumber:s,onClick:a,isLiked:i,playlistId:o,showGoToAlbum:l=!0,...n}=r,[c,x]=g.useState(!1),m=s??("track_number"in e?e.track_number:null),u=m?`${m}. `:null,b=v(A(S=>{var E;return(E=S.item)==null?void 0:E.id})),Q=a&&(S=>{a&&a(S)});return t.jsxs(K,{onOpenChange:x,children:[t.jsx(L,{asChild:!0,children:t.jsxs(N,{disabled:e.is_playable&&!e.is_playable||!!e.restrictions,onClick:Q,...n,icon:b===e.id||"linked_from"in e&&((T=e.linked_from)==null?void 0:T.id)===b?q:!1,children:[u,e.name]})}),t.jsx(Y,{track:e,open:c,isLiked:i,playlistId:o,showGoToAlbum:l})]})}const Z=g.memo(z);function ee(){const r=k(),e=v(A(s=>s.refetch));return s=>{const{deviceId:a="",uris:i,contextUri:o,offset:l}=s;return h.player.startResumePlayback(a,o,i,{[typeof l=="number"?"position":"uri"]:l}).then(()=>{setTimeout(()=>{e(),r.invalidateQueries({queryKey:[y.player.QUEUE]})},250)}).catch(n=>{console.error(n);let c="There was an issue playing the track";n.message.includes("NO_ACTIVE_DEVICE")&&(c="No active device. Could not play."),d.error("Playback Error",{description:c})})}}export{Z as T,ee as u};
